UDF_UpdateSpontaneousResource <br>
[h:spellName = json.get( macro.args, "spellName" )]
[h:spells = json.get( macro.args, "Spells" )]
[h:activeToken = json.get( macro.args, "ID" )]
[h:direction = json.get( macro.args, "direction" )]
[h:innerIndex = json.get( macro.args, "index" )]
[h: resources = json.get( macro.args, "Resources" )]
[h: outerIndex = json.get(  macro.args, "outerIndex" )]
[h: maxValue = json.get( macro.args, "maxCasts")]
[h: spellByLevelAndClassEntry = json.get( resources, outerIndex )]
[h: usedByClassAndLevel = json.get( spellByLevelAndClassEntry, "used" )]

[h: newValue = 0]
[h: currentSpell = json.get( Spells, spellName )]
[h: currentSpellValue = json.get(  currentSpell, "used" )]

[h: newMaxValue = maxValue]

[IF( direction == "up"), CODE: {
    [h:newValue = add( currentSpellValue, 1 )]
    [h:newMaxValue = subtract( maxValue, 1 )]
    [h:usedByClassAndLevel = subtract( usedByClassAndLevel, 1 )]
}]

[IF( direction == "down"), CODE: {
    [h:newValue = subtract( currentSpellValue, 1 )]
    [h:newMaxValue = add( maxValue, 1 )]
    [h: usedByClassAndLevel = add( usedByClassAndLevel, 1 )]
}]

[h: currentSpell = json.set( currentSpell, "used", newValue )]
[h: Spells = json.set( Spells, spellname, currentSpell) ]

[h: spellByLevelAndClassEntry = json.set( spellByLevelAndClassEntry, "maxCasts", newMaxValue) ]
[h: spellByLevelAndClassEntry = json.set( spellByLevelAndClassEntry, "used", usedByClassAndLevel) ]
[h: resources = json.set( resources, outerIndex, spellByLevelAndClassEntry )]

[h:selectTokens( activeToken, 0 )]
[h:setProperty( "SpontaneousResourcesJSON", resources, activeToken )]


[h: args = json.set( "{}" , "ID", activeToken, "Resources", resources  )]

[MACRO("SpontaneousResourceFrame@Lib:TokenLab") : args ]




