[h: Spells = json.get( macro.args, "spells" )]
[h: spellClass = json.get( macro.args, "spellClass" )]
[h: spellLevel = json.get( macro.args, "spellLevel" )]
[h: unlimited = json.get( macro.args, "unlimited" )]
[h: usedForLevel = json.get( macro.args, "used" )]
[h: maxCasts = json.get( macro.args, "maxCasts" )]
[h: names = json.fields( Spells ) ]
[h: activeToken = json.get( macro.args, "ID" ) ]
[h: resources = json.get( macro.args, "Resources" )]
[h: outerIndex = json.get( macro.args, "index" )]


[h: imageFormatString = 	"<img src='%s' border=0 height=45 width=45 alt='%s'>"]
[h: IncrementImage = 	strformat(imageFormatString, tblImage( "TokenLabImages",  2 ), 	"Add one to resource used")]
[h: DecrementImage =        strformat(imageFormatString, tblImage("TokenLabImages", 3 ), 	"Subtract one to resource used")]
[h:index = 0]


[FOREACH ( spellName, names, "" ), CODE: {
   [h: DC = json.get( json.get( Spells, spellName ), "dc" )]
   [h: used = json.get( json.get( Spells, spellName ), "used" )]
   <tr>
   <td>[r:spellName]</td>
   <td>([r:spellClass])</td>
   <td>DC [r:DC]</td>
       [h: upargs   = json.set("{}", "spellName", spellName,   "ID", activeToken, "direction", "up" , "Spells", Spells, "index", index, "Resources", resources, "outerIndex", outerIndex, "maxCasts", maxCasts )]
       [h: downargs   = json.set("{}", "spellName", spellName,   "ID", activeToken, "direction", "up" , "Spells", Spells, "index", index, "Resources", resources, "outerIndex", outerIndex, "maxCasts", maxCasts )]
       [h: UpButton = macroLink(IncrementImage, 	"UDF_UpdateSpontaneousResource@Lib:TokenLab", "self", upargs, activeToken )]
       [h: DownButton = macroLink(DecrementImage, 	"UDF_UpdateSpontaneousResource@Lib:TokenLab", "self", downargs, activeToken )]

        <td>[r:DownButton]</td>
        <td>[r:used]</td>
        <td>[r:UpButton]</td>
        <td> [r:maxCasts] Level [r:spellLevel] spells left</td>
    [h: index = index + 1]
    </tr>
}]